<mxfile host="app.diagrams.net" modified="2022-04-29T02:16:02.595Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36" etag="BqE5ivBmNU0TU0TeK4Xb" version="17.4.0" type="github" pages="11">
  <diagram id="beaRy6wAavuNoinMqOIt" name="A-100-2: Update user">
    <mxGraphModel dx="1186" dy="692" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-4" value="API Update&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="150" y="90" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-21" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="110" y="827" width="280" height="340" as="geometry" />
        </mxCell>
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-17" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="BwrMmU0Z1vJl7dJkqxiA-21" vertex="1">
          <mxGeometry width="280" height="340" as="geometry" />
        </mxCell>
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-5" value="&lt;b&gt;Update&lt;/b&gt; &lt;b&gt;basic&lt;/b&gt; &lt;b&gt;info&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;text-align: left&quot;&gt;name_sei&lt;/span&gt;&lt;br style=&quot;padding: 0px ; margin: 0px ; text-align: left&quot;&gt;&lt;span style=&quot;text-align: left&quot;&gt;name_mei&lt;/span&gt;&lt;br style=&quot;padding: 0px ; margin: 0px ; text-align: left&quot;&gt;&lt;span style=&quot;text-align: left&quot;&gt;kana_sei&lt;/span&gt;&lt;br style=&quot;padding: 0px ; margin: 0px ; text-align: left&quot;&gt;&lt;span style=&quot;text-align: left&quot;&gt;kana_mei&lt;/span&gt;&lt;br style=&quot;padding: 0px ; margin: 0px ; text-align: left&quot;&gt;&lt;span style=&quot;text-align: left&quot;&gt;tel&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="BwrMmU0Z1vJl7dJkqxiA-21" vertex="1">
          <mxGeometry x="80" y="40" width="120" height="100" as="geometry" />
        </mxCell>
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-6" value="&lt;b&gt;Update company_branch&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;text-align: left&quot;&gt;company_branch_id&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="BwrMmU0Z1vJl7dJkqxiA-21" vertex="1">
          <mxGeometry x="80" y="170" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-7" value="&lt;b&gt;Update block_flag&lt;/b&gt;&lt;br&gt;&lt;span style=&quot;text-align: left&quot;&gt;block_flag&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="BwrMmU0Z1vJl7dJkqxiA-21" vertex="1">
          <mxGeometry x="80" y="264" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="BwrMmU0Z1vJl7dJkqxiA-19" value="Transaction" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="BwrMmU0Z1vJl7dJkqxiA-21" vertex="1">
          <mxGeometry x="10" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qYMu9HZ2ewkB9-f9gRvB-1" target="qYMu9HZ2ewkB9-f9gRvB-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qYMu9HZ2ewkB9-f9gRvB-1" target="qYMu9HZ2ewkB9-f9gRvB-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qYMu9HZ2ewkB9-f9gRvB-1" target="qYMu9HZ2ewkB9-f9gRvB-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qYMu9HZ2ewkB9-f9gRvB-1" target="qYMu9HZ2ewkB9-f9gRvB-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qYMu9HZ2ewkB9-f9gRvB-1" target="qYMu9HZ2ewkB9-f9gRvB-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="qYMu9HZ2ewkB9-f9gRvB-1" target="qYMu9HZ2ewkB9-f9gRvB-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-1" value="Params Validator&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="340" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-2" value="name: name_sei&lt;br&gt;type: string&lt;br&gt;max_length: 64" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="20" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-3" value="name: name_mei&lt;br&gt;type: string&lt;br&gt;max_length: 64" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="100" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-4" value="name: kana_mei&lt;br&gt;type: regex&lt;br&gt;format: hiragana&lt;br&gt;max_length: 128" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="260" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-5" value="name:&amp;nbsp;&lt;span style=&quot;font-family: &amp;#34;times new roman&amp;#34; ; font-size: 13.3333px ; background-color: rgb(255 , 255 , 255)&quot;&gt;kana_sei&lt;/span&gt;&lt;br&gt;type: regex&lt;br&gt;format: hiragana&lt;br&gt;max_length: 128" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="180" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-6" value="name: tel&lt;br&gt;type: regex&lt;br&gt;format: tel&lt;br&gt;max_length: 16" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="340" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="qYMu9HZ2ewkB9-f9gRvB-7" value="name: block_flag&lt;br&gt;type: in&lt;br&gt;in: [0, 1]" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="420" width="130" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="_ILvuDlCsghR4p4DLs_p" name="B289 flow admin">
    <mxGraphModel dx="3708" dy="773" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2336" pageHeight="1654" math="0" shadow="0">
      <root>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-0" />
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-1" parent="T7XIgcGGt-_lKm9ebYKq-0" />
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-2" target="T7XIgcGGt-_lKm9ebYKq-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-2" value="Admin call" style="ellipse;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-2170" y="210" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-3" target="T7XIgcGGt-_lKm9ebYKq-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-3" value="Admin routes&lt;br&gt;Xử lý verify token" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1710" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-5" value="confirmed_key" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1950" y="220" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-6" value="company_id" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1950" y="250" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-7" target="T7XIgcGGt-_lKm9ebYKq-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-1280" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-7" value="workers_controller&lt;br&gt;#bulk_update" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1490" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-9" value="confirmed_key" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1570" y="220" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-10" value="company_id" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1570" y="250" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-14" target="T7XIgcGGt-_lKm9ebYKq-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-14" target="T7XIgcGGt-_lKm9ebYKq-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-135" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-14" target="T7XIgcGGt-_lKm9ebYKq-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-1260" y="150" />
              <mxPoint x="-340" y="150" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-14" value="validate&lt;br&gt;params" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1300" y="210" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-15" value="Return response&lt;br&gt;error" style="ellipse;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-400" y="380" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-17" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1301" y="191" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-24" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1" connectable="0">
          <mxGeometry x="-1170" y="160" width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-23" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="T7XIgcGGt-_lKm9ebYKq-24" vertex="1">
          <mxGeometry width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-19" value="Validate data type&lt;br&gt;1. company_id: number, required&lt;br&gt;2. confirmed_key: string, required" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-24" vertex="1">
          <mxGeometry x="60" y="10" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-21" value="Validate logic&lt;br&gt;1. company_id: phải là partner_company&lt;br&gt;2. confirmed_key: phải tồn tại file tương ứng trên s3" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-24" vertex="1">
          <mxGeometry x="20" y="100" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-24" source="T7XIgcGGt-_lKm9ebYKq-19" target="T7XIgcGGt-_lKm9ebYKq-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-26" target="T7XIgcGGt-_lKm9ebYKq-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-168" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-26" target="T7XIgcGGt-_lKm9ebYKq-165" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-26" value="skilled_workers_confirm_logic" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1930" y="390" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-28" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1310" y="290" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-144" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-31" target="T7XIgcGGt-_lKm9ebYKq-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-31" value="skilled_workers_regist_logic" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-2180" y="390" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-33" target="T7XIgcGGt-_lKm9ebYKq-36" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-1595" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-133" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-33" target="T7XIgcGGt-_lKm9ebYKq-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-137" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-33" target="T7XIgcGGt-_lKm9ebYKq-128" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-33" value="Validate common" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1660" y="380" width="130" height="80" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-37" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1" connectable="0">
          <mxGeometry x="-1685" y="500" width="180" height="100" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-36" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="T7XIgcGGt-_lKm9ebYKq-37" vertex="1">
          <mxGeometry width="180" height="100" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-35" value="1. Validate version&lt;br&gt;2. Validate records import&lt;br&gt;3. Validate nếu file rỗng" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-37" vertex="1">
          <mxGeometry x="20" y="20" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-129" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1" connectable="0">
          <mxGeometry x="-1450" y="500" width="960" height="1500" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-128" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#000000;strokeWidth=4;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry width="960" height="1500" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-102" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=default;strokeWidth=4;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="30" y="380" width="500" height="150" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-51" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1" connectable="0">
          <mxGeometry x="319" y="190" width="290" height="140" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-44" value="Get raw data to object" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="T7XIgcGGt-_lKm9ebYKq-51" vertex="1">
          <mxGeometry y="40" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-45" value="20211024" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-51" vertex="1">
          <mxGeometry x="190" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-51" source="T7XIgcGGt-_lKm9ebYKq-44" target="T7XIgcGGt-_lKm9ebYKq-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-46" value="20220327" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-51" vertex="1">
          <mxGeometry x="190" y="50" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-51" source="T7XIgcGGt-_lKm9ebYKq-44" target="T7XIgcGGt-_lKm9ebYKq-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-47" value="admin" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-51" vertex="1">
          <mxGeometry x="190" y="100" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-51" source="T7XIgcGGt-_lKm9ebYKq-44" target="T7XIgcGGt-_lKm9ebYKq-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-52" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1" connectable="0">
          <mxGeometry x="319" y="20" width="290" height="140" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-53" value="Reader data" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="T7XIgcGGt-_lKm9ebYKq-52" vertex="1">
          <mxGeometry y="40" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-54" value="20211024" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-52" vertex="1">
          <mxGeometry x="190" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-52" source="T7XIgcGGt-_lKm9ebYKq-53" target="T7XIgcGGt-_lKm9ebYKq-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-56" value="20220327" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-52" vertex="1">
          <mxGeometry x="190" y="50" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-52" source="T7XIgcGGt-_lKm9ebYKq-53" target="T7XIgcGGt-_lKm9ebYKq-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-58" value="admin" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-52" vertex="1">
          <mxGeometry x="190" y="100" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-52" source="T7XIgcGGt-_lKm9ebYKq-53" target="T7XIgcGGt-_lKm9ebYKq-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-60" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-53" target="T7XIgcGGt-_lKm9ebYKq-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-62" value="Validate từng object" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="309" y="390" width="140" height="110" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-44" target="T7XIgcGGt-_lKm9ebYKq-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-71" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1" connectable="0">
          <mxGeometry x="50" y="470" width="190" height="340" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-70" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="T7XIgcGGt-_lKm9ebYKq-71" vertex="1">
          <mxGeometry width="190" height="340" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-64" value="Validate model" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-71" vertex="1">
          <mxGeometry x="30" y="20" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-67" value="Validate dropdown input ở file excel" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-71" vertex="1">
          <mxGeometry x="30" y="100" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-68" value="Validate các trường ngày tháng ở file excel" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-71" vertex="1">
          <mxGeometry x="30" y="180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-69" value="Validate các trường tỉnh, thành phố ..." style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-71" vertex="1">
          <mxGeometry x="30" y="270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-99" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-62" target="T7XIgcGGt-_lKm9ebYKq-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-76" value="No" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="439" y="420" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-80" value="Yes" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="375" y="500" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-82" value="Validate gender" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="314" y="570" width="130" height="90" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-78" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-62" target="T7XIgcGGt-_lKm9ebYKq-82" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="379" y="537" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-85" value="Validate duplicate &lt;br&gt;dữ liệu trong sheet" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="291.5" y="730" width="175" height="90" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-86" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-82" target="T7XIgcGGt-_lKm9ebYKq-85" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-89" value="Yes" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="375" y="660" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-90" value="No" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="439" y="590" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-92" value="Add line error =&amp;gt; vào từng row" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="559" y="585" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-62" target="T7XIgcGGt-_lKm9ebYKq-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-82" target="T7XIgcGGt-_lKm9ebYKq-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-95" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-85" target="T7XIgcGGt-_lKm9ebYKq-92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-96" value="No" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="459" y="750" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-97" value="Yes" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="385" y="820" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-101" value="Validate line error" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="331.5" y="880" width="95" height="90" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-98" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-85" target="T7XIgcGGt-_lKm9ebYKq-101" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="379" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-103" value="loop từng object" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="35" y="400" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-105" value="Push từng data vào hash response" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="490" y="895" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-106" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-101" target="T7XIgcGGt-_lKm9ebYKq-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-107" value="No" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="425" y="900" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-108" value="Yes" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="399" y="970" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-110" value="Exists worker?" style="rhombus;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="331.5" y="1060" width="95" height="90" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-101" target="T7XIgcGGt-_lKm9ebYKq-110" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-112" value="Build create worker theo version" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="510" y="1020" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-113" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-110" target="T7XIgcGGt-_lKm9ebYKq-112" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-114" value="Build update worker theo version" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="510" y="1140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-115" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-110" target="T7XIgcGGt-_lKm9ebYKq-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-117" value="Yes" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="466.5" y="1150" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-119" value="No" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="466.5" y="1030" width="30" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-121" value="Push object build vào hash response" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="679" y="1080" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-122" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-112" target="T7XIgcGGt-_lKm9ebYKq-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-123" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-114" target="T7XIgcGGt-_lKm9ebYKq-121" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-124" value="set skip_message" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="319" y="1274" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-125" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-121" target="T7XIgcGGt-_lKm9ebYKq-124" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-126" value="return hash response" style="rounded=0;whiteSpace=wrap;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="319" y="1370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-127" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" source="T7XIgcGGt-_lKm9ebYKq-124" target="T7XIgcGGt-_lKm9ebYKq-126" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-130" value="loop từng row" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-129" vertex="1">
          <mxGeometry x="10" y="10" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-136" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-450" y="390" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-140" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-980" y="470" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-167" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1" connectable="0">
          <mxGeometry x="-2140" y="650" width="620" height="400" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-165" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#82b366;strokeWidth=1;fillColor=#d5e8d4;" parent="T7XIgcGGt-_lKm9ebYKq-167" vertex="1">
          <mxGeometry width="620" height="400" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-164" value="" style="group" parent="T7XIgcGGt-_lKm9ebYKq-167" vertex="1" connectable="0">
          <mxGeometry x="30" y="30" width="560" height="338" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-162" value="" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#6c8ebf;strokeWidth=1;fillColor=#dae8fc;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry width="560" height="338" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-146" value="is_updated?&lt;br&gt;lấy dữ liệu từ logic confirm" style="rhombus;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="220" y="8" width="120" height="110" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-148" value="Update row" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="20" y="33" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-150" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" source="T7XIgcGGt-_lKm9ebYKq-146" target="T7XIgcGGt-_lKm9ebYKq-148" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-149" value="Create row" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="420" y="33" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-151" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" source="T7XIgcGGt-_lKm9ebYKq-146" target="T7XIgcGGt-_lKm9ebYKq-149" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-152" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="192" y="35" width="30" height="25" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-153" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="335" y="38" width="30" height="25" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-154" value="Build update data theo version" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#b85450;strokeWidth=1;fillColor=#f8cecc;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="20" y="138" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-158" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" source="T7XIgcGGt-_lKm9ebYKq-148" target="T7XIgcGGt-_lKm9ebYKq-154" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-155" value="Build create data theo version" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#b85450;strokeWidth=1;fillColor=#f8cecc;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="420" y="128" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-160" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" source="T7XIgcGGt-_lKm9ebYKq-149" target="T7XIgcGGt-_lKm9ebYKq-155" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-156" value="Xử lý update data vào trong database" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="20" y="243" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-159" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="T7XIgcGGt-_lKm9ebYKq-164" source="T7XIgcGGt-_lKm9ebYKq-154" target="T7XIgcGGt-_lKm9ebYKq-156" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-157" value="Xử lý insert data vào trong database" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry x="420" y="238" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-161" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" source="T7XIgcGGt-_lKm9ebYKq-155" target="T7XIgcGGt-_lKm9ebYKq-157" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-163" value="loop từng row data" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-164" vertex="1">
          <mxGeometry width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-166" value="Transaction" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="T7XIgcGGt-_lKm9ebYKq-167" vertex="1">
          <mxGeometry x="3" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-170" value="Return success" style="ellipse;whiteSpace=wrap;html=1;strokeColor=#000000;strokeWidth=1;" parent="T7XIgcGGt-_lKm9ebYKq-1" vertex="1">
          <mxGeometry x="-1890" y="1110" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="T7XIgcGGt-_lKm9ebYKq-171" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="T7XIgcGGt-_lKm9ebYKq-1" source="T7XIgcGGt-_lKm9ebYKq-165" target="T7XIgcGGt-_lKm9ebYKq-170" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="yy6QKDLrqWyr6tzr2juc" name="B289 flow batch">
    <mxGraphModel dx="1186" dy="692" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" background="none" math="0" shadow="0">
      <root>
        <mxCell id="QO6DEZsLp3Uj3bY03InB-0" />
        <mxCell id="QO6DEZsLp3Uj3bY03InB-1" parent="QO6DEZsLp3Uj3bY03InB-0" />
        <mxCell id="PKkzBxfOja_jNcLJkX_M-12" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="615" y="700" width="420" height="340" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-1" target="sfsygTBULw4LmqpVUuAS-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-1" value="Preview API" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="200" y="55" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-2" target="sfsygTBULw4LmqpVUuAS-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-2" value="Tạo bản ghi ở batchjob tương ứng =&amp;gt; status confirm" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="400" y="65" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-4" target="sfsygTBULw4LmqpVUuAS-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-4" value="Trigger batch lên SNS" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="810" y="65" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-6" value="Return status success + key excel + import_excel_batches.id" style="ellipse;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="1010" y="52.5" width="150" height="85" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-8" target="sfsygTBULw4LmqpVUuAS-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="100" y="95" />
              <mxPoint x="100" y="210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-8" target="sfsygTBULw4LmqpVUuAS-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="100" y="95" />
              <mxPoint x="100" y="340" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-8" target="sfsygTBULw4LmqpVUuAS-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="100" y="95" />
              <mxPoint x="100" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-8" target="sfsygTBULw4LmqpVUuAS-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-8" value="Client" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="30" y="60" width="30" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-10" target="sfsygTBULw4LmqpVUuAS-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-10" value="HTTP pooling API/check status" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="200" y="170" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-11" target="sfsygTBULw4LmqpVUuAS-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-11" value="Truy vấn vào batchjob theo key quy định" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="400" y="180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-13" target="sfsygTBULw4LmqpVUuAS-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-13" value="Lấy status tương ứng và trả về bên FE phục vụ cho việc pooling" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="610" y="180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-15" value="Return status 200 + status tương ứng" style="ellipse;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="810" y="170" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-26" target="sfsygTBULw4LmqpVUuAS-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-26" value="Get data preview API" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="200" y="300" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-28" target="sfsygTBULw4LmqpVUuAS-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-28" value="Lấy data trong redis theo key(quy định tương ứng)" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="400" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-30" target="sfsygTBULw4LmqpVUuAS-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-30" value="Phân trang theo params và trả về data" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="610" y="310" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-31" value="Return status 200 + data tương ứng" style="ellipse;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="810" y="300" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-35" target="sfsygTBULw4LmqpVUuAS-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-35" value="Update API" style="ellipse;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="200" y="430" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-37" target="sfsygTBULw4LmqpVUuAS-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-37" value="Tạo bản ghi tương ứng ở batchjob =&amp;gt; status update" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="610" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-39" target="sfsygTBULw4LmqpVUuAS-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-39" value="Trigger batch lên SNS" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="820" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-40" value="Return status success" style="ellipse;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="1020" y="430" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-42" target="sfsygTBULw4LmqpVUuAS-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-42" value="Xóa dữ liệu ở redis" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="410" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-47" target="sfsygTBULw4LmqpVUuAS-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-47" value="Admin&lt;br&gt;" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="30" y="530" width="30" height="70" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-50" value="confirm key" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="90" y="540" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-51" value="confirm key" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="120" y="440" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-56" value="excel file" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="120" y="65" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-58" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="sfsygTBULw4LmqpVUuAS-57" target="sfsygTBULw4LmqpVUuAS-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-57" value="Upload excel lên AWS" style="rounded=0;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="600" y="65" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sfsygTBULw4LmqpVUuAS-59" value="import_excel_batches.id" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="100" y="180" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-1" target="PKkzBxfOja_jNcLJkX_M-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-1" value="Ruby SDK" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="430" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-2" target="PKkzBxfOja_jNcLJkX_M-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-2" value="SNS" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="640" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-5" target="PKkzBxfOja_jNcLJkX_M-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-5" value="SQS" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="820" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-6" target="PKkzBxfOja_jNcLJkX_M-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-6" value="ECS =&amp;gt; run batch" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="820" y="910" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-9" value="TODO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="555" y="797" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-10" value="Call logic run batch" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="430" y="910" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-13" value="import_excel_batches&lt;br&gt;1. status" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="250" y="640" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-15" target="PKkzBxfOja_jNcLJkX_M-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-15" value="Upload File&amp;nbsp;" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="350" y="1150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-16" target="PKkzBxfOja_jNcLJkX_M-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-16" value="Valid" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="555" y="1150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-17" value="Redis =&amp;gt; valid" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="555" y="1250" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QO6DEZsLp3Uj3bY03InB-1" source="PKkzBxfOja_jNcLJkX_M-21" target="PKkzBxfOja_jNcLJkX_M-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-21" value="Update workA =&amp;gt; khác giới tính =&amp;gt; file excel" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="350" y="1330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-22" value="File =&amp;gt; vẫn thế" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="560" y="1330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-23" value="Redis =&amp;gt; valid" style="rounded=1;whiteSpace=wrap;html=1;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="560" y="1430" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PKkzBxfOja_jNcLJkX_M-25" value="Sai" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QO6DEZsLp3Uj3bY03InB-1" vertex="1">
          <mxGeometry x="480" y="1420" width="60" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Batch ALL">
    <mxGraphModel dx="1186" dy="692" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2336" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="567PAdTRRMbh6oGiuQLg-36" value="" style="group" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1" connectable="0">
          <mxGeometry x="12" y="40" width="1630" height="2070" as="geometry" />
        </mxCell>
        <mxCell id="567PAdTRRMbh6oGiuQLg-34" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry y="629.3515850144092" width="618.4822521419828" height="1401.8731988472623" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-0" value="Lấy danh sách&lt;br&gt;&lt;b&gt;@works&amp;nbsp;&lt;/b&gt;&lt;b&gt;&amp;nbsp;- &lt;/b&gt;riêng cho việc joining và truy vấn trong database, phục vụ cho việc bulk delete &lt;b&gt;progress_aggregated_work&lt;/b&gt; tương ứng và việc thống kê&amp;nbsp;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="173.57405140758874" y="640.2881844380404" width="289.2900856793146" height="109.36599423631124" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-1" value="&lt;div&gt;SELECT&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`main_work_type_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`sub_work_type_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; `works`.`a_item_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`b_item_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`c_item_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`d_item_id`,&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&amp;nbsp; work_groups.work_date AS work_date,&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; CASE WHEN work_groups.schedule_flag = 1 THEN works.calcd_sum_man_hours ELSE 0 END&lt;/div&gt;&lt;div&gt;&amp;nbsp; ) AS schedule_man_hours,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; CASE WHEN work_groups.schedule_flag = 0 THEN works.calcd_sum_man_hours ELSE 0 END&lt;/div&gt;&lt;div&gt;&amp;nbsp; ) AS result_man_hours&amp;nbsp;&lt;/div&gt;&lt;div&gt;FROM&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;span&gt;&amp;nbsp;`works`&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; INNER JOIN `work_groups` ON `work_groups`.`id` = `works`.`work_group_id`&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `work_groups`.`deleted_at` = &#39;1970-01-01 00:00:00&#39;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; INNER JOIN `main_work_types` ON `main_work_types`.`id` = `works`.`main_work_type_id`&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `main_work_types`.`deleted_at` = &#39;1970-01-01 00:00:00&#39;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; LEFT OUTER JOIN `sub_work_types` ON `sub_work_types`.`id` = `works`.`sub_work_type_id`&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `sub_work_types`.`deleted_at` = &#39;1970-01-01 00:00:00&#39;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;WHERE&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `works`.`deleted_at` = &#39;1970-01-01 00:00:00&#39;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `works`.`updated_at` &amp;lt;= &lt;b&gt;@aggregated_at&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `work_groups`.`field_id` = &lt;b&gt;@field_id&lt;/b&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `work_groups`.`work_date` BETWEEN &lt;b&gt;@input_start_date&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND &lt;b&gt;@input_end_date&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; sub_work_types.other_flag != 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; OR sub_work_types.id IS NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; )&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `works`.`main_work_type_id` IS NOT NULL&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `works`.`state_handling_flag` != 1&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; AND `main_work_types`.`other_flag` != 1&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="832.96" width="797.04" height="550" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="WFbMBUP2ziU1kK5NttpU-0" target="WFbMBUP2ziU1kK5NttpU-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-4" value="Lấy danh sách &lt;b&gt;@progress_work_type_setting_group&lt;/b&gt; tương ứng của field, phục vụ cho việc group, tính toán" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="175.08035495716032" y="941.5417867435159" width="286.2974296205631" height="59.654178674351584" as="geometry" />
        </mxCell>
        <mxCell id="ygxaWCv3HxxnlEioHgV8-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="WFbMBUP2ziU1kK5NttpU-5" target="uAmXVkTUW6dZBD79vU70-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-5" value="SELECT *&lt;br&gt;FROM progress_work_type_settings&lt;br&gt;LEFT OUTER JOIN field_main_work_types ON field_main_work_types.id = progress_work_type_settings.field_main_work_type_id&lt;br&gt;LEFT OUTER JOIN field_sub_work_types ON field_sub_work_types.id = progress_work_type_settings.sub_work_type_id&lt;br&gt;WHERE field_main_work_types.field_id = @progress_aggregate_history.field_id&lt;br&gt;AND progress_work_type_settings.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_main_work_types.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_sub_work_types.deleted_at = &quot;1970/01/01&quot;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="628.4577723378214" y="727.7809798270894" width="432.4388004895961" height="154.10662824207495" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="WFbMBUP2ziU1kK5NttpU-4" target="WFbMBUP2ziU1kK5NttpU-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WFbMBUP2ziU1kK5NttpU-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" target="uAmXVkTUW6dZBD79vU70-10" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="318.219094247246" y="1070.7925072046112" as="sourcePoint" />
            <mxPoint x="318.219094247246" y="1120.5043227665706" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="UBo7ACk7U0r55q0Idaj--0" value="Xử lý filter @works, bằng logic =&amp;gt; &lt;b&gt;@work_filters&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="173.8234394124847" y="1031.0230547550434" width="288.79130966952266" height="59.654178674351584" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="WFbMBUP2ziU1kK5NttpU-4" target="UBo7ACk7U0r55q0Idaj--0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-1" value="&lt;b&gt;@works&lt;/b&gt; có tồn tại hay không" style="rhombus;whiteSpace=wrap;html=1;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="252.13127294981643" y="782.463976945245" width="132.16566707466342" height="89.48126801152738" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="WFbMBUP2ziU1kK5NttpU-0" target="uAmXVkTUW6dZBD79vU70-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-1" target="WFbMBUP2ziU1kK5NttpU-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-7" value="" style="group" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1" connectable="0">
          <mxGeometry x="302.75703794369645" y="881.8876080691643" width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-5" value="YES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="uAmXVkTUW6dZBD79vU70-7" vertex="1">
          <mxGeometry width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-8" value="&amp;nbsp;Xử lý group data lấy được từ câu query bằng câu lệnh group_by =&amp;gt;&amp;nbsp;&lt;b&gt;@progress_work_type_setting_group&lt;/b&gt;&lt;br&gt;{ [main_work_type_id, sub_work_type_id] =&amp;gt; item_list_id, ... }" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="1108.0049082007345" y="759.9962247838617" width="367.5979192166463" height="79.53890489913545" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-10" value="&lt;b style=&quot;text-align: left&quot;&gt;@work_filters&lt;/b&gt;&amp;nbsp;có tồn tại hay không" style="rhombus;whiteSpace=wrap;html=1;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="238.0358629130967" y="1120.5043227665706" width="160.35648714810284" height="99.42363112391931" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-12" value="Xử lý group, tính toán &lt;b&gt;@work_filter&lt;/b&gt; bằng logic&lt;br&gt;=&amp;gt; &lt;b&gt;@work_filter_calculates&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="173.57405140758874" y="1269.6397694524496" width="288.79130966952266" height="59.654178674351584" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-10" target="uAmXVkTUW6dZBD79vU70-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-15" value="" style="group" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1" connectable="0">
          <mxGeometry x="302.75703794369645" y="1229.8703170028818" width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-14" value="YES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="uAmXVkTUW6dZBD79vU70-15" vertex="1">
          <mxGeometry width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-16" value="1. Duyệt từng bản ghi work&lt;br&gt;2. Set place_item_id tương ứng dựa vào @&lt;b&gt;progress_work_type_setting_group&lt;/b&gt;&lt;br&gt;3. Kiểm tra xem bản ghi work có thỏa mãn điều kiện sau&lt;br&gt;3.1 Có tồn tại cặp key main/work trong @&lt;b&gt;progress_work_type_setting_group&lt;/b&gt;&lt;br&gt;3.2 item_list_id tương ứng của cặp main/sub không nhập, hoặc giá trị place_item_id bắt buộc phải tồn tại" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="559.63" y="1003.18" width="450.37" height="138.2" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="UBo7ACk7U0r55q0Idaj--0" target="uAmXVkTUW6dZBD79vU70-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-18" value="1. Xử lý group dữ liệu work_filters theo cặp key&lt;br&gt;[&lt;b&gt;work_date, main_work_type_id, sub_work_type_id, place_item_id&lt;/b&gt;]&lt;br&gt;2. Tính toán schedule_man_hours, result_man_hours các bản ghi tương ứng được group (sử dụng hàm&amp;nbsp;&lt;b&gt;sum&lt;/b&gt;)" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="505.7588739290086" y="1190.1008645533143" width="500.7711138310894" height="132.23342939481267" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-34" value="" style="group;container=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1" connectable="0">
          <mxGeometry x="173.8234394124847" y="1359.121037463977" width="289.04069767441865" height="208.78962536023056" as="geometry">
            <mxRectangle x="92.26" y="929" width="50" height="44" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-20" value="1. Tạo mảng &lt;b&gt;@progress_aggregated_results&lt;/b&gt;&lt;br&gt;2. Loop &lt;b&gt;@&lt;/b&gt;&lt;b&gt;work_filter_calculates, &lt;/b&gt;assign dữ liệu&lt;b&gt; &lt;/b&gt;cho&lt;b&gt;&amp;nbsp;@progress_aggregated_results&lt;/b&gt;&lt;br&gt;3. Bulk import bằng&lt;b&gt; activerecord_import&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="uAmXVkTUW6dZBD79vU70-34" vertex="1">
          <mxGeometry y="99.42363112391931" width="289.04069767441865" height="109.36599423631124" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fillColor=#f5f5f5;strokeColor=#666666;" parent="uAmXVkTUW6dZBD79vU70-34" source="uAmXVkTUW6dZBD79vU70-24" target="uAmXVkTUW6dZBD79vU70-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-24" value="Xử lý đối với bảng &lt;b&gt;progress_aggregate_results&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="uAmXVkTUW6dZBD79vU70-34" vertex="1">
          <mxGeometry x="31.279920776897534" width="226.4808561206236" height="49.711815561959654" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-41" value="" style="group;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1" connectable="0">
          <mxGeometry x="173.57405140758874" y="1598.7319884726226" width="289.1703794369645" height="317.1613832853026" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-22" value="Xử lý đối với bảng &lt;b&gt;progress_aggregated_works&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="uAmXVkTUW6dZBD79vU70-41" vertex="1">
          <mxGeometry x="31.293954908738755" width="226.58246961948694" height="49.71181556195965" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-28" value="1. Tạo mảng &lt;b&gt;@progress_aggregated_results&lt;/b&gt;&lt;br&gt;2. Loop &lt;b&gt;@&lt;/b&gt;&lt;b&gt;work_filter_calculates, &lt;/b&gt;assign dữ liệu&lt;b&gt; &lt;/b&gt;cho&lt;b&gt;&amp;nbsp;@progress_aggregated_results&lt;/b&gt;&lt;br&gt;3. Bulk import bằng&lt;b&gt; activerecord_import&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="uAmXVkTUW6dZBD79vU70-41" vertex="1">
          <mxGeometry y="207.79538904899132" width="289.1703794369645" height="109.36599423631122" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fillColor=#f5f5f5;strokeColor=#666666;" parent="uAmXVkTUW6dZBD79vU70-41" source="uAmXVkTUW6dZBD79vU70-29" target="uAmXVkTUW6dZBD79vU70-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-29" value="Bulk delete các bản ghi &lt;b&gt;progress_aggregated_works&lt;/b&gt; tương ứng với &lt;b&gt;@works&lt;/b&gt; đang chạy batch" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" parent="uAmXVkTUW6dZBD79vU70-41" vertex="1">
          <mxGeometry x="31.293954908738755" y="89.48126801152736" width="226.58246961948694" height="69.59654178674351" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fillColor=#f5f5f5;strokeColor=#666666;" parent="uAmXVkTUW6dZBD79vU70-41" source="uAmXVkTUW6dZBD79vU70-22" target="uAmXVkTUW6dZBD79vU70-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-20" target="uAmXVkTUW6dZBD79vU70-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-43" value="&lt;div&gt;INSERT INTO `progress_aggregate_results` (&lt;/div&gt;&lt;div&gt;&amp;nbsp; `id`, `progress_aggregate_history_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `work_date`, `main_work_type_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `sub_work_type_id`, `place_item_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `schedule_man_hours`, `result_man_hours`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `created_at`, `updated_at`, `deleted_at`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `create_user_id`, `update_user_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `admin_updated_at`, `create_admin_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `update_admin_id`&lt;/div&gt;&lt;div&gt;)&amp;nbsp;&lt;/div&gt;&lt;div&gt;VALUES&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 260, &#39;2021-11-26&#39;, 4, 4, 64311,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 25.0, 0.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ),&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 260, &#39;2021-11-25&#39;, 1, NULL, NULL,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 210.0, 10.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ) ON DUPLICATE KEY&amp;nbsp;&lt;/div&gt;&lt;div&gt;UPDATE&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `progress_aggregate_results`.`updated_at` =&amp;nbsp;&lt;/div&gt;&lt;div&gt;VALUES&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (`updated_at`)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;imageAspect=1;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="1030.0030599755203" y="890.0001152737752" width="289.2900856793146" height="485.1873198847262" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-45" value="&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;DELETE FROM&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; `progress_aggregated_works`&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;WHERE&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; `progress_aggregated_works`.`deleted_at` = &#39;1970-01-01 00:00:00&#39;&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; AND `progress_aggregated_works`.`work_id` IN (&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; &amp;nbsp; SELECT&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; `works`.`id`&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; &amp;nbsp; FROM&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;@works&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;font style=&quot;font-size: 11px&quot;&gt;&amp;nbsp; )&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 11px&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="650" y="1649.77" width="586.06" height="146.48" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-29" target="uAmXVkTUW6dZBD79vU70-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-47" value="&lt;div&gt;INSERT INTO `progress_aggregated_works` (&lt;/div&gt;&lt;div&gt;&amp;nbsp; `id`, `work_id`, `work_date`, `main_work_type_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `sub_work_type_id`, `place_item_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `schedule_man_hours`, `result_man_hours`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `created_at`, `updated_at`, `deleted_at`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `create_user_id`, `update_user_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `admin_updated_at`, `create_admin_id`,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `update_admin_id`&lt;/div&gt;&lt;div&gt;)&amp;nbsp;&lt;/div&gt;&lt;div&gt;VALUES&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 11979372, &#39;2021-11-26&#39;, 4, 4,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 64311, 10.0, 0.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ),&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 11979375, &#39;2021-11-26&#39;, 4, 4,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; 64311, 15.0, 0.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ),&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 11979371, &#39;2021-11-25&#39;, 1, NULL,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 0.0, 10.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ),&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 11979369, &#39;2021-11-25&#39;, 1, NULL,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 10.0, 0.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ),&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 11979370, &#39;2021-11-25&#39;, 1, NULL,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, 200.0, 0.0, &#39;2021-12-03 23:09:36&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &#39;2021-12-03 23:09:36&#39;, &#39;1970-01-01 00:00:00&#39;,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL, NULL, NULL, NULL, NULL&lt;/div&gt;&lt;div&gt;&amp;nbsp; ) ON DUPLICATE KEY&amp;nbsp;&lt;/div&gt;&lt;div&gt;UPDATE&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; `progress_aggregated_works`.`updated_at` =&amp;nbsp;&lt;/div&gt;&lt;div&gt;VALUES&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; (`updated_at`)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="1332.7294981640148" y="863.9913544668588" width="283.3047735618115" height="664.149855907781" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-28" target="uAmXVkTUW6dZBD79vU70-47" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="541.670746634027" y="1861.2103746397695" />
              <mxPoint x="541.670746634027" y="2050.1152737752163" />
              <mxPoint x="1474.3818849449206" y="2050.1152737752163" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-50" value="Update &lt;b&gt;@progress_aggrergate_history&lt;/b&gt; thành status &lt;b&gt;success&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="173.76358629130968" y="1956.6570605187321" width="288.7813341493268" height="53.68876080691643" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-12" target="uAmXVkTUW6dZBD79vU70-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-52" value="END" style="ellipse;whiteSpace=wrap;html=1;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="258.1165850673195" y="2042.1613832853027" width="119.7062423500612" height="27.838616714697405" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-28" target="uAmXVkTUW6dZBD79vU70-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-61" value="" style="group" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1" connectable="0">
          <mxGeometry x="178.56181150550796" y="802.3487031700289" width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-60" value="NO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="uAmXVkTUW6dZBD79vU70-61" vertex="1">
          <mxGeometry width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-64" value="" style="group" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1" connectable="0">
          <mxGeometry x="171.57894736842107" y="1138.400576368876" width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-63" value="NO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="uAmXVkTUW6dZBD79vU70-64" vertex="1">
          <mxGeometry width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-66" value="START" style="ellipse;whiteSpace=wrap;html=1;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="258.1165850673195" y="454.3659942363113" width="119.7062423500612" height="79.53890489913545" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-12" target="uAmXVkTUW6dZBD79vU70-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-68" target="WFbMBUP2ziU1kK5NttpU-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-68" value="Dữ liệu đầu vào là &lt;b&gt;@progress_aggregate_history&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="226.88323133414931" y="556.7723342939482" width="182.17294981640148" height="59.654178674351584" as="geometry" />
        </mxCell>
        <mxCell id="JU5rvKVwVeTCvCTt9m4v-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=11;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-20" target="uAmXVkTUW6dZBD79vU70-43" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="608" y="1513" />
              <mxPoint x="608" y="1455" />
              <mxPoint x="1175" y="1455" />
            </Array>
            <mxPoint x="1175" y="1440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JU5rvKVwVeTCvCTt9m4v-2" value="&lt;b&gt;@works&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="755.1468788249695" y="308.2132564841499" width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="JU5rvKVwVeTCvCTt9m4v-3" value="sub_query: &lt;b&gt;@works&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="536.6829865361077" y="1688.21325648415" width="59.8531211750306" height="29.827089337175792" as="geometry" />
        </mxCell>
        <mxCell id="567PAdTRRMbh6oGiuQLg-35" value="TRANSACTION&lt;br&gt;Nếu xử lý lỗi =&amp;gt; &lt;b&gt;ROLLBACK&lt;/b&gt; và update lại status của progress_aggregate_history = &lt;b&gt;error&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="567PAdTRRMbh6oGiuQLg-36" vertex="1">
          <mxGeometry x="9.975520195838435" y="638.299711815562" width="146.640146878825" height="89.48126801152738" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-50" target="uAmXVkTUW6dZBD79vU70-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-1" target="uAmXVkTUW6dZBD79vU70-50" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="70.32741738066079" y="1118.2672910662823" as="targetPoint" />
            <Array as="points">
              <mxPoint x="88" y="827" />
              <mxPoint x="88" y="1983" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-62" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-10" target="uAmXVkTUW6dZBD79vU70-50" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="127.68665850673187" y="1170.2161383285302" as="targetPoint" />
            <Array as="points">
              <mxPoint x="88" y="1170" />
              <mxPoint x="88" y="1983" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uAmXVkTUW6dZBD79vU70-71" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="567PAdTRRMbh6oGiuQLg-36" source="uAmXVkTUW6dZBD79vU70-66" target="uAmXVkTUW6dZBD79vU70-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="1vLqcknvX-34HEY4nWMS" name="ONLY DIFF">
    <mxGraphModel dx="1694" dy="991" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2339" pageHeight="3300" math="0" shadow="0">
      <root>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-0" />
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-1" parent="Y1YA_CgOly7EXAXlO_jH-0" />
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-2" value="&lt;b style=&quot;text-align: center&quot;&gt;Duyệt mảng&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;text-align: center&quot;&gt;changed_works&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#fff2cc;dashed=1;verticalAlign=top;fontStyle=1;strokeColor=#d6b656;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="670" y="1240" width="1600" height="830" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-4" target="Y1YA_CgOly7EXAXlO_jH-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-4" value="START" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="870" y="520" width="120" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-6" target="Y1YA_CgOly7EXAXlO_jH-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-6" value="&lt;b&gt;Lấy changed_works[] từ bảng works theo điều kiện:&lt;br&gt;&lt;/b&gt;updated_at/deleted_at/created_at nằm trong khoảng&lt;br&gt;[last_success_at, current_aggregated_at]&lt;br&gt;--------&lt;br&gt;Left join&amp;nbsp;progress_work_type_settings để lấy cột&amp;nbsp;item_list_id và id&lt;br&gt;(on main_work_type_id, &lt;u&gt;sub_work_type_id&lt;/u&gt;)" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="750" y="940" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-9" target="Y1YA_CgOly7EXAXlO_jH-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-8" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-9" target="Y1YA_CgOly7EXAXlO_jH-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-9" value="&lt;b&gt;Lấy thông tin chạy batch thành công gần nhất từ bảng&amp;nbsp;progress_aggregate_histories (của field_id)&lt;br&gt;&lt;/b&gt;status = 1&lt;br&gt;field_id&lt;br&gt;------&lt;br&gt;&lt;b&gt;Sắp xếp giảm dần theo id, lấy giá trị đầu tiên (limit 1)&lt;/b&gt;&lt;br&gt;last_success_id =&amp;nbsp;id&lt;br&gt;last_success_at =&amp;nbsp;&amp;nbsp;aggregated_at" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="810" y="650" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-11" target="Y1YA_CgOly7EXAXlO_jH-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-11" value="&lt;b&gt;Tạo mới thông tin chạy batch lần này&amp;nbsp;&lt;/b&gt;&lt;b&gt;(của field_id)&lt;/b&gt;&lt;b&gt;&lt;br&gt;&amp;nbsp;bảng&amp;nbsp;progress_aggregate_histories&lt;br&gt;&lt;/b&gt;status = 0&lt;br&gt;field_id&lt;br&gt;aggregated_at = aggregated_time&amp;nbsp;&lt;br&gt;------&lt;br&gt;&lt;b&gt;Kết quả&lt;/b&gt;&lt;br&gt;current_id =&amp;nbsp;id" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="750" y="310" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-13" target="Y1YA_CgOly7EXAXlO_jH-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-13" value="&lt;b&gt;Duyệt mảng: i = 0-&amp;gt;length&lt;br&gt;&lt;/b&gt;changed_work =&amp;nbsp;changed_works[i]&lt;br&gt;------&lt;br&gt;&lt;b&gt;Tính toán trong vòng lặp:&lt;/b&gt;&lt;br&gt;&lt;br&gt;is_in_setting = changed_work.setting_id != null &amp;amp;&amp;amp; (item_list_id&amp;nbsp; == null ||&amp;nbsp;changed_work.a/b/c/d(tương ứng item_list_id) != null)&lt;br&gt;&lt;br&gt;progress_aggregated_work&amp;nbsp;=&amp;nbsp;progress_aggregated_works&lt;br&gt;.filter(work_id == changed_work.id)&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="710" y="1280" width="440" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-16" target="Y1YA_CgOly7EXAXlO_jH-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-16" target="Y1YA_CgOly7EXAXlO_jH-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-16" value="&lt;b&gt;Lấy progress_aggregated_works điều kiện:&lt;/b&gt;&lt;br&gt;work_id in changed_works[id]" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="750" y="1100" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-20" target="Y1YA_CgOly7EXAXlO_jH-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1180" y="1560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-18" value="TRUE" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="Y1YA_CgOly7EXAXlO_jH-17" vertex="1" connectable="0">
          <mxGeometry x="-0.3143" y="-2" relative="1" as="geometry">
            <mxPoint x="6" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-19" value="FALSE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-20" target="Y1YA_CgOly7EXAXlO_jH-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-20" value="&lt;span style=&quot;font-style: normal&quot;&gt;! is_in_setting&amp;nbsp;or&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: normal&quot;&gt;changed_work.deleted or&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: normal&quot;&gt;changed_work.blocked&lt;/span&gt;&lt;span style=&quot;font-style: normal&quot;&gt;&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;shadow=0;fontFamily=Helvetica;fontSize=12;align=center;strokeWidth=1;spacing=6;spacingTop=-4;fontStyle=2" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="810" y="1510" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-22" target="Y1YA_CgOly7EXAXlO_jH-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-22" value="&lt;b&gt;Tìm&amp;nbsp;&lt;/b&gt;&lt;b&gt;old_&lt;/b&gt;&lt;b&gt;progress_aggregate_result theo:&lt;/b&gt;&lt;br&gt;work_date,&amp;nbsp;main_work_type_id,&amp;nbsp;&lt;u&gt;sub_work_type_id,&amp;nbsp;place_item_id&lt;/u&gt;&lt;br&gt;(của progress_aggregated_work)&lt;br&gt;--------&lt;br&gt;Nếu old_progress_aggregate_result != null: Trừ man_hours" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1470" y="1500" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-23" value="TRUE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-25" target="Y1YA_CgOly7EXAXlO_jH-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-24" value="FALSE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.564;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-25" target="Y1YA_CgOly7EXAXlO_jH-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-25" value="&lt;span style=&quot;font-style: normal&quot;&gt;progress_aggregated_work&amp;nbsp; != null ?&lt;/span&gt;&lt;span style=&quot;font-style: normal&quot;&gt;&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;shadow=0;fontFamily=Helvetica;fontSize=12;align=center;strokeWidth=1;spacing=6;spacingTop=-4;fontStyle=2" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1150" y="1730" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-27" target="Y1YA_CgOly7EXAXlO_jH-33" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1290" y="1690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-27" value="&lt;b&gt;Tìm old_progress_aggregate_result theo:&lt;/b&gt;&lt;br&gt;work_date,&amp;nbsp;main_work_type_id,&lt;u&gt;&amp;nbsp;sub_work_type_id,&amp;nbsp;place_item_id&lt;br&gt;&lt;/u&gt;(của progress_aggregated_work)&lt;br&gt;--------&lt;br&gt;Nếu old_progress_aggregate_result&amp;nbsp;!= null: Trừ man_hours&lt;br&gt;--------" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1470" y="1700" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-28" value="TRUE" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-29" target="Y1YA_CgOly7EXAXlO_jH-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-29" value="&lt;span style=&quot;font-style: normal&quot;&gt;progress_aggregated_work&amp;nbsp; != null ?&lt;/span&gt;&lt;span style=&quot;font-style: normal&quot;&gt;&lt;br&gt;&lt;/span&gt;" style="rhombus;whiteSpace=wrap;html=1;shadow=0;fontFamily=Helvetica;fontSize=12;align=center;strokeWidth=1;spacing=6;spacingTop=-4;fontStyle=2" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1150" y="1520" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-31" target="Y1YA_CgOly7EXAXlO_jH-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-31" value="&lt;b&gt;Tìm new_progress_aggregate_result theo:&lt;/b&gt;&lt;br&gt;work_date,&amp;nbsp;main_work_type_id,&amp;nbsp;&lt;u&gt;sub_work_type_id,&amp;nbsp;place_item_id&lt;/u&gt;&lt;br&gt;(của changed_work)&lt;br&gt;--------&lt;br&gt;Nếu&amp;nbsp;new_progress_aggregate_result&amp;nbsp;!= null: Cộng man_hours&lt;br&gt;Nếu&amp;nbsp;new_progress_aggregate_result == null: Tạo cùng man_hours" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="750" y="1700" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-32" value="&lt;b&gt;Xoá progress_aggregated_work&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1870" y="1500" width="360" height="120" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-33" value="&lt;b&gt;Update&amp;nbsp;progress_aggregated_works với&lt;/b&gt;&lt;br&gt;work_date, main_work_type_id, sub_work_type_id, place_item_id)&lt;br&gt;(của changed_work)" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1870" y="1700" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-34" value="&lt;b&gt;Tạo mới progress_aggregated_works với&lt;/b&gt;&lt;br&gt;work_date, main_work_type_id, sub_work_type_id, place_item_id)&lt;br&gt;(của changed_work)" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1470" y="1900" width="360" height="140" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-36" target="Y1YA_CgOly7EXAXlO_jH-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-36" value="&lt;b&gt;Lấy&amp;nbsp;&lt;/b&gt;&lt;b&gt;progress_aggregate_results:&lt;br&gt;&lt;br&gt;Theo changed_works: &lt;/b&gt;&lt;br&gt;work_date,&amp;nbsp;main_work_type_id, sub_work_type_id,&amp;nbsp;&lt;u&gt;place_item_id&lt;br&gt;&lt;/u&gt;works.id in changed_works[id]&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;br&gt;&lt;b&gt;Hoặc theo&amp;nbsp;progress_aggregated_works :&lt;/b&gt;&lt;br&gt;work_date,&amp;nbsp;main_work_type_id, sub_work_type_id,&amp;nbsp;&lt;u&gt;place_item_id&lt;br&gt;&lt;/u&gt;progress_aggregated_works.id in&amp;nbsp;progress_aggregated_works[id]&lt;u&gt;&lt;br&gt;&lt;/u&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1190" y="1060" width="360" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-37" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-38" target="Y1YA_CgOly7EXAXlO_jH-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-38" value="insert into progress_aggregate_histories (field_id, aggregated_at, status)&lt;br&gt;values (:field_id, :aggregated_time, 0)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;size=17;align=left;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1190" y="400" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-39" value="select * from&amp;nbsp;progress_aggregate_histories&lt;br&gt;where status = 1 and field = :field_id&lt;br&gt;order aggregated_at by desc&lt;br&gt;limit 1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;size=17;align=left;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1240" y="630" width="400" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-41" target="Y1YA_CgOly7EXAXlO_jH-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-41" value="&lt;br&gt;aggregated_time = now()" style="rounded=0;whiteSpace=wrap;html=1;align=center;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="750" y="120" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-42" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-43" target="Y1YA_CgOly7EXAXlO_jH-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-43" value="select works.*, work_settings.id as setting_id, work_settings.item_list_id from&amp;nbsp;works&lt;br&gt;&lt;br&gt;join work_groups on works.work_group_id = work_groups.id and work_groups.field_id = :field_id&lt;br&gt;&lt;br&gt;left join (&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;select settings.*, mains.field_id, mains.main_work_type_id, subs.sub_work_type_id from progress_work_type_settings as settings&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;left join field_main_work_types as mains on mains.id = settings.field_main_work_type_id&amp;nbsp;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;left join field_sub_work_types as subs on subs.id = settings.field_sub_work_type_id&lt;br&gt;) as work_settings on works.main_work_type_id = work_settings.main_work_type_id &lt;br&gt;and (work_settings.sub_work_type_id&amp;nbsp;= null or work_settings.sub_work_type_id = works.sub_work_type_id)&lt;br&gt;&lt;br&gt;where (updated_at between :last_success_at and :aggregated_time&amp;nbsp;)&lt;br&gt;or (deleted_at between :last_success_at and :aggregated_time&amp;nbsp;)&lt;br&gt;or (created_at between :last_success_at and :aggregated_time&amp;nbsp;)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;size=17;align=left;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="30" y="460" width="760" height="240" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-44" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-45" target="Y1YA_CgOly7EXAXlO_jH-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-45" value="select * from&amp;nbsp;progress_aggregated_works&lt;br&gt;where id in (:&lt;span style=&quot;text-align: center&quot;&gt;&lt;b&gt;changed_works&lt;/b&gt;&lt;/span&gt;)&lt;br&gt;&lt;br&gt;--------&lt;br&gt;SQL sẽ hiểu đây là câu &lt;b&gt;sub_querry&lt;/b&gt;, nên không vấn đề gì nha" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;size=17;align=left;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="390" y="1040" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-46" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-47" target="Y1YA_CgOly7EXAXlO_jH-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-47" value="&lt;b&gt;Danh sách update_results:&lt;/b&gt;&lt;br&gt;select distinct&amp;nbsp;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;* from&amp;nbsp;&lt;span style=&quot;text-align: center&quot;&gt;progress_aggregate_results as results&lt;br&gt;join works &lt;br&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;join work_groups where work_groups.id = work.id&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;on&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;work_date =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;work_groups&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;work_date&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; and&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;main_work_type_id =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;main_work_type_id&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; and&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;where works.id in :&lt;b&gt;changed_work(sub-query)&lt;/b&gt;&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; and (&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;= null &lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;or&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;=&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;a_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;or&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;=&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.b&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;or&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;=&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.c&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;or&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;=&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.d&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;_item_id)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;b&gt;Danh sách old_results:&lt;/b&gt;&lt;br&gt;select distinct&amp;nbsp;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;* from&amp;nbsp;&lt;span style=&quot;text-align: center&quot;&gt;progress_aggregate_results as results&lt;br&gt;join&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;progress_aggregated_works as works&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;span&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;join work_groups where work_groups.id = work.id&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;on&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;work_date =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;work_groups&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;work_date&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; and&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;main_work_type_id =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;main_work_type_id&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; and&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id =&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;where works.work_id in :&lt;/span&gt;&lt;b style=&quot;text-align: center&quot;&gt;&amp;nbsp;changed_work(sub-query)&lt;/b&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;and&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;and&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;= null&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;or&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;results.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&amp;nbsp;=&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;works.&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;place_item_id&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;br&gt;&lt;b&gt;Danh sách results ảnh hưởng:&lt;br&gt;&lt;/b&gt;results = update_results + old_results (phần chung thì tính là 1 lần)&lt;br&gt;&lt;/span&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;size=17;align=left;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="1670" y="800" width="560" height="380" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-48" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;endFill=0;" parent="Y1YA_CgOly7EXAXlO_jH-1" source="Y1YA_CgOly7EXAXlO_jH-49" target="Y1YA_CgOly7EXAXlO_jH-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Y1YA_CgOly7EXAXlO_jH-49" value="results.filter(result -&amp;gt; {&lt;br&gt;&lt;span&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;result.work_date ==&amp;nbsp; changed_work.work_date &amp;amp;&amp;amp;&lt;br&gt;&lt;span&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;result.main_work_type_id == changed_work.main_work_type_id &amp;amp;&amp;amp;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;(result.&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id == null ||&amp;nbsp;&lt;/span&gt;result.&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id ==&lt;/span&gt;&amp;nbsp;changed_work.&lt;span style=&quot;text-align: center&quot;&gt;sub_work_type_id)&lt;/span&gt;&amp;nbsp;&amp;amp;&amp;amp;&lt;br&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;(result.place_item_id == null || result.place_item_id == changed_work.a_item_id || result.place_item_id == &lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;changed_work.b_item_id || result.place_item_id == changed_work.c_item_id || result.place_item_id == &lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;changed_work.d_item_id)&lt;br&gt;})&lt;br&gt;Tương tự cho các block khác" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;size=17;align=left;" parent="Y1YA_CgOly7EXAXlO_jH-1" vertex="1">
          <mxGeometry x="30" y="1680" width="600" height="160" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="2IJdWpSvLsYcz3dNfhUG" name="BATCH DIFF ALL">
    <mxGraphModel dx="1483" dy="868" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2336" math="0" shadow="0">
      <root>
        <mxCell id="r-6SCS9JS_Q6p-U2xnw3-0" />
        <mxCell id="r-6SCS9JS_Q6p-U2xnw3-1" parent="r-6SCS9JS_Q6p-U2xnw3-0" />
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-7" value="" style="group" parent="r-6SCS9JS_Q6p-U2xnw3-1" vertex="1" connectable="0">
          <mxGeometry x="220" y="50" width="833" height="570" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-59" value="Lấy ra danh sách các progress_work_type_settings chưa được chạy batch (đổi địa điểm)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="VUwFRzM8nIQZEjgPCMLg-7" vertex="1">
          <mxGeometry x="11.732394366197184" width="222.91549295774647" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="s8o9FF4gS-mtJzS9CfyD-1" value="Lấy ra danh sách [main,sub] đã đồng bộ ở các lần lịch sử trước =&amp;gt; &lt;b&gt;@progress_work_type_is_batched&lt;br&gt;[main, sub]&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="VUwFRzM8nIQZEjgPCMLg-7" vertex="1">
          <mxGeometry y="147.77777777777777" width="246.38028169014083" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="VUwFRzM8nIQZEjgPCMLg-7" source="RsV1DuCLyckvF859KtTO-59" target="s8o9FF4gS-mtJzS9CfyD-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s8o9FF4gS-mtJzS9CfyD-2" value="&lt;div&gt;&lt;span&gt;SELECT main_work_type_id, sub_work_type_id&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;FROM progress_aggregate_results&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;INNER JOIN progress_aggregate_histories ON&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;span&gt;progress_aggregate_histories.id =&amp;nbsp;&lt;/span&gt;&lt;span&gt;progress_aggregate_results.&lt;/span&gt;&lt;span&gt;progress_aggregate_history_id&lt;br&gt;WHERE&amp;nbsp;&lt;/span&gt;progress_aggregate_histories.field_id = @field_id&lt;br&gt;&lt;span&gt;AND&amp;nbsp;&lt;/span&gt;progress_aggregate_histories.id &amp;lt;&amp;nbsp;&lt;b&gt;@progress_aggregate_history.id&lt;/b&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="VUwFRzM8nIQZEjgPCMLg-7" vertex="1">
          <mxGeometry x="305.0422535211268" y="137.22222222222223" width="481.0281690140845" height="105.55555555555556" as="geometry" />
        </mxCell>
        <mxCell id="s8o9FF4gS-mtJzS9CfyD-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="VUwFRzM8nIQZEjgPCMLg-7" source="s8o9FF4gS-mtJzS9CfyD-1" target="s8o9FF4gS-mtJzS9CfyD-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s8o9FF4gS-mtJzS9CfyD-3" value="Lấy ra danh sách [main,sub] đã chưa bộ ở các lần lịch sử trước =&amp;gt; &lt;b&gt;@progress_work_type_batch_all&lt;br&gt;[[main, sub] =&amp;gt; item_list_id]&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="VUwFRzM8nIQZEjgPCMLg-7" vertex="1">
          <mxGeometry y="321.94444444444446" width="246.38028169014083" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="s8o9FF4gS-mtJzS9CfyD-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="VUwFRzM8nIQZEjgPCMLg-7" source="s8o9FF4gS-mtJzS9CfyD-1" target="s8o9FF4gS-mtJzS9CfyD-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="s8o9FF4gS-mtJzS9CfyD-6" value="&lt;div&gt;&lt;/div&gt;SELECT *&lt;br&gt;FROM progress_work_type_settings&lt;br&gt;LEFT OUTER JOIN field_main_work_types ON field_main_work_types.id = progress_work_type_settings.field_main_work_type_id&lt;br&gt;LEFT OUTER JOIN field_sub_work_types ON field_sub_work_types.id = progress_work_type_settings.sub_work_type_id&lt;br&gt;WHERE field_main_work_types.field_id = @progress_aggregate_history.field_id&lt;br&gt;AND progress_work_type_settings.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_main_work_types.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_sub_work_types.deleted_at = &quot;1970/01/01&quot;&lt;span&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="VUwFRzM8nIQZEjgPCMLg-7" vertex="1">
          <mxGeometry x="305.0422535211268" y="285" width="527.9577464788732" height="158.33333333333334" as="geometry" />
        </mxCell>
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="VUwFRzM8nIQZEjgPCMLg-7" source="s8o9FF4gS-mtJzS9CfyD-3" target="s8o9FF4gS-mtJzS9CfyD-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-1" value="Xử lý bằng code, remove đi các phần tử [main,sub] đã tồn tại ở&lt;b&gt; @&lt;/b&gt;&lt;b&gt;progress_work_type_is_batched&lt;/b&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="VUwFRzM8nIQZEjgPCMLg-7" vertex="1">
          <mxGeometry x="445.83098591549293" y="485.55555555555554" width="246.38028169014083" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="VUwFRzM8nIQZEjgPCMLg-7" source="s8o9FF4gS-mtJzS9CfyD-6" target="VUwFRzM8nIQZEjgPCMLg-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sSDgTFBMNbOVSoMMUStR-0" value="" style="group" parent="r-6SCS9JS_Q6p-U2xnw3-1" vertex="1" connectable="0">
          <mxGeometry x="130" y="690" width="1556.1399999999999" height="1580" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-27" value="Batch DIFF ALL" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry y="196.2091503267974" width="127.79874213836477" height="41.30718954248366" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-30" value="Lấy danh sách &lt;b&gt;@works, &lt;/b&gt;không nằm trong thời gian thay đổi (&lt;b&gt;lastest_progress_aggregate_history&lt;/b&gt; và &lt;b&gt;@aggregated_time&lt;/b&gt;)&lt;br&gt;&lt;br&gt;1. @lastest_progress_aggregate_history&lt;br&gt;2. @progress_aggregate_history&lt;br&gt;3. @&lt;span&gt;aggregated_time&lt;br&gt;&lt;/span&gt;4. start_date = progress_field_settings.start_date&lt;br&gt;5. end_date = progress_field_settings.end_date&lt;br&gt;6.&amp;nbsp;&lt;span style=&quot;text-align: center&quot;&gt;&lt;b&gt;@&lt;/b&gt;&lt;/span&gt;&lt;b style=&quot;text-align: center&quot;&gt;progress_work_type_batch_all&lt;/b&gt;&lt;br&gt;&amp;nbsp;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="82.53668763102725" y="289.1503267973857" width="308.8469601677149" height="206.53594771241833" as="geometry" />
        </mxCell>
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-27" target="RsV1DuCLyckvF859KtTO-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-31" value="SELECT *&lt;br&gt;FROM works&lt;br&gt;INNER JOIN work_groups ON work_groups.id = works.work_group_id&lt;br&gt;INNER JOIN main_work_types ON main_work_types.id = works.&amp;nbsp;main_work_type_id&lt;br&gt;LEFT OUTER JOINS sub_work_types ON sub_work_types.id = works.sub_work_type_id&lt;br&gt;WHERE works.updated_at &amp;lt;=&amp;nbsp;&lt;b&gt;@lastest_progress_aggregate_history.&lt;/b&gt;&lt;b&gt;aggregated_time&lt;/b&gt;&lt;br&gt;AND work_groups.work_date BETWEEN (:start_date, :end_date)&lt;br&gt;AND work_groups.field_id = @progress_aggregate_history.field_id&lt;br&gt;AND&amp;nbsp;sub_work_types.other_flag !=1 OR sub_work_types.id IS NULL&lt;br&gt;AND works.main_work_type_id IS NOT NULL&lt;br&gt;AND works.state_handling_flag != 1&lt;br&gt;AND main_work_types.other_flag != 1&lt;br&gt;AND work_groups.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND works.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND main_work_types.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND &lt;b&gt;(main_work_type_id, sub_work_type_id) IN ((&lt;/b&gt;&lt;span style=&quot;text-align: center&quot;&gt;&lt;b&gt;@&lt;/b&gt;&lt;/span&gt;&lt;b style=&quot;text-align: center&quot;&gt;progress_work_type_batch_all&lt;/b&gt;&lt;b&gt;))&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="170.398322851153" width="617.6939203354298" height="237.51633986928107" as="geometry" />
        </mxCell>
        <mxCell id="VUwFRzM8nIQZEjgPCMLg-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-30" target="RsV1DuCLyckvF859KtTO-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-34" value="Lấy thông tin progress_work_type_settings, tương ứng với field_id, group theo main, sub, nhằm xác định main, sub -&amp;gt; item_list_id&lt;br&gt;1. @progress_aggregate_history&lt;br&gt;&lt;br&gt;Sau đó thực hiện group theo main, sub để lấy item_list_id tương ứng:&amp;nbsp;&lt;b&gt;progress_work_type_setting_group&lt;/b&gt;&lt;br&gt;{ [main_work_type_id, sub_work_type_id] =&amp;gt; item_list_id }" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="53.24947589098532" y="526.6666666666667" width="367.42138364779873" height="134.24836601307192" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-30" target="RsV1DuCLyckvF859KtTO-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-35" value="SELECT *&lt;br&gt;FROM progress_work_type_settings&lt;br&gt;LEFT OUTER JOIN field_main_work_types ON field_main_work_types.id = progress_work_type_settings.field_main_work_type_id&lt;br&gt;LEFT OUTER JOIN field_sub_work_types ON field_sub_work_types.id = progress_work_type_settings.sub_work_type_id&lt;br&gt;WHERE field_main_work_types.field_id = @progress_aggregate_history.field_id&lt;br&gt;AND progress_work_type_settings.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_main_work_types.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_sub_work_types.deleted_at = &quot;1970/01/01&quot;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="513.8574423480084" y="526.6666666666667" width="756.1425576519915" height="134.24836601307192" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-34" target="RsV1DuCLyckvF859KtTO-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fWi1f5fFc3dsj06Epf7p-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-38" target="RsV1DuCLyckvF859KtTO-39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-38" value="Khái báo 5 mảng works tương ứng để xử lý với a_item_id, b_item_id, c_item_id, d_item_id và item_list_id = NULL&lt;br&gt;&lt;br&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;@work_calculate_by_a_items&lt;/b&gt;&amp;nbsp;= []&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;@work_calculate_by_b_items&lt;/b&gt; = []&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;@work_calculate_by_c_items&lt;/b&gt; = []&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt; @work_calculate_by_d_itemss&lt;/b&gt; = []&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;@work_calculate_no_item_lists&lt;/b&gt; = []&lt;/div&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="53.24947589098532" y="697.0588235294118" width="367.42138364779873" height="129.08496732026146" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-34" target="RsV1DuCLyckvF859KtTO-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fWi1f5fFc3dsj06Epf7p-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-39" target="fWi1f5fFc3dsj06Epf7p-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-39" value="Dựa vào mảng progress_work_type_setting_group, chia các cặp &lt;b&gt;main,sub&lt;/b&gt;, ra làm 5 nhóm:&lt;br&gt;1. Theo item_list_id = 1,2,3,4&lt;br&gt;2. Theo item_list_id = nil" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="449.99744234800835" y="709.967320261438" width="276.8972746331237" height="103.26797385620917" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-43" value="Xử lý với 5 mảng&amp;nbsp;&lt;b&gt;@work_calculate_by_a_item_ids (b,c,d),&amp;nbsp;&lt;/b&gt;&lt;b&gt;@work_calculate_no_item_list_ids. &lt;/b&gt;Xử lý group, tính toán data, import vào mảng&lt;b&gt;&amp;nbsp;@progress_aggregate_results&lt;/b&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="53.24947589098532" y="877.7777777777778" width="367.42138364779873" height="72.28758169934642" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-38" target="RsV1DuCLyckvF859KtTO-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-44" value="SELECT&amp;nbsp;&lt;br&gt;main_work_type_id,&lt;br&gt;sub_work_type_id,&lt;br&gt;work_groups.work_date AS work_date,&lt;br&gt;works.#{ITEM_ID_COLUMNS[item_list_id]} AS place_item_id,&lt;br&gt;SUM(CASE WHEN work_groups.schedule_flag = 1 THEN works.calcd_sum_man_hours ELSE 0 END) AS schedule_man_hours,&lt;br&gt;SUM(CASE WHEN work_groups.schedule_flag = 0 THEN works.calcd_sum_man_hours ELSE 0 END) AS result_man_hours&lt;br&gt;FROM&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;b&gt;@work_calculate_by_a_items&lt;/b&gt;&lt;br&gt;AND works.#{ITEM_ID_COLUMNS[item_list_id]}&amp;nbsp;IS NOT NULL&lt;br&gt;GROUP BY&lt;br&gt;work_groups.work_date,&lt;br&gt;main_work_type_id,&lt;br&gt;sub_work_type_id,&lt;br&gt;works.#{ITEM_ID_COLUMNS[item_list_id]}&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="513.8574423480084" y="831.3071895424838" width="756.1425576519915" height="222.0261437908497" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-43" target="RsV1DuCLyckvF859KtTO-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-45" value="SELECT&amp;nbsp;&lt;br&gt;main_work_type_id,&lt;br&gt;sub_work_type_id,&lt;br&gt;work_groups.work_date AS work_date,&lt;br&gt;NULL AS place_item_id,&lt;br&gt;SUM(CASE WHEN work_groups.schedule_flag = 1 THEN works.calcd_sum_man_hours ELSE 0 END) AS schedule_man_hours,&lt;br&gt;SUM(CASE WHEN work_groups.schedule_flag = 0 THEN works.calcd_sum_man_hours ELSE 0 END) AS result_man_hours&lt;br&gt;FROM&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;b&gt;@work_calculate_no_item_lists&lt;/b&gt;&lt;br&gt;GROUP BY&lt;br&gt;work_groups.work_date,&lt;br&gt;main_work_type_id,&lt;br&gt;sub_work_type_id" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="513.8574423480084" y="1073.9869281045753" width="756.1425576519915" height="222.0261437908497" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-43" target="RsV1DuCLyckvF859KtTO-45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-48" value="1. Bulk import progress_aggregatged_works, dựa vào mảng &lt;b&gt;@&lt;/b&gt;&lt;b&gt;work_calculate_no_item_lists,&lt;br&gt;&lt;/b&gt;&lt;b&gt;@work_calculate_by_a_items,&lt;br&gt;&lt;/b&gt;&lt;b&gt;@work_calculate_by_b_items,&lt;br&gt;&lt;/b&gt;&lt;b&gt;@work_calculate_by_c_items,&lt;br&gt;&lt;/b&gt;&lt;b&gt;@work_calculate_by_d_items&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="91.77" y="1249.54" width="258.23" height="100.46" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-53" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-43" target="RsV1DuCLyckvF859KtTO-48" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="351.4465408805031" y="950.0653594771243" />
              <mxPoint x="351.4465408805031" y="1177.2549019607845" />
              <mxPoint x="236.42767295597483" y="1177.2549019607845" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-49" value="SELECT works.id&lt;span&gt;,&amp;nbsp;&lt;/span&gt;works.&lt;span&gt;main_work_type_id, works.&lt;/span&gt;&lt;span&gt;sub_work_type_id,&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;div&gt;CASE&lt;/div&gt;&lt;div&gt;WHEN progress_work_type_settings.item_list_id = 1 AND progress_work_type_settings.field_sub_work_type_id = field_sub_work_type_id.id THEN works.a_item_id&lt;/div&gt;&lt;div&gt;WHEN progress_work_type_settings.item_list_id = 2 AND progress_work_type_settings.field_sub_work_type_id = field_sub_work_type_id.id THEN works.b_item_id&lt;/div&gt;&lt;div&gt;WHEN progress_work_type_settings.item_list_id = 3 AND progress_work_type_settings.field_sub_work_type_id = field_sub_work_type_id.id THEN works.b_item_id&lt;/div&gt;&lt;div&gt;WHEN progress_work_type_settings.item_list_id = 4 AND progress_work_type_settings.field_sub_work_type_id = field_sub_work_type_id.id THEN works.b_item_id&lt;/div&gt;&lt;div&gt;ELSE NULL&amp;nbsp;&lt;span&gt;END AS place_item_id,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;work_groups.work_date AS work_date,&lt;/div&gt;&lt;div&gt;CASE WHEN work_groups.schedule_flag = 1 THEN works.calcd_sum_man_hours ELSE 0 END) AS schedule_man_hours,&lt;/div&gt;&lt;span&gt;CASE WHEN work_groups.schedule_flag = 0 THEN works.calcd_sum_man_hours ELSE 0 END) AS result_man_hours&lt;br&gt;&lt;/span&gt;FROM&lt;b&gt;&amp;nbsp;(&lt;/b&gt;&lt;b&gt;@work_calculate_by_a_items&lt;/b&gt;&amp;nbsp;OR&amp;nbsp;&lt;b&gt;@work_calculate_by_b_items &lt;/b&gt;OR&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;b&gt;@work_calculate_by_c_items &lt;/b&gt;OR&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;b&gt;@work_calculate_by_d_items &lt;/b&gt;OR&lt;b&gt;&amp;nbsp;@work_calculate_no_item_lists)&lt;/b&gt;&lt;br&gt;LEFT OUTER JOIN&amp;nbsp;field_main_work_types ON&amp;nbsp;field_main_work_types.main_work_type_id = works.main_work_type_id&lt;br&gt;LEFT OUTER&amp;nbsp;JOIN&amp;nbsp;field_sub_work_types ON field_sub_work_types.sub_work_type_id = works.&amp;nbsp;field_sub_work_types&lt;br&gt;LEFT OUTER&amp;nbsp;JOIN&amp;nbsp;progress_work_type_settings ON&amp;nbsp;progress_work_type_settings.fied_main_work_type_id = field_main_work_types.id" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="336.00419287211736" y="1380.00045751634" width="933.9958071278825" height="227.18954248366015" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.599;entryDx=0;entryDy=0;entryPerimeter=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-48" target="RsV1DuCLyckvF859KtTO-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-50" value="End" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="173.06079664570228" y="1497.3856209150329" width="127.79874213836477" height="41.30718954248366" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-48" target="RsV1DuCLyckvF859KtTO-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-52" value="Xử lý import vào progress_aggregate_results&lt;br&gt;1. Bản ghi nào đã được tạo tương ứng cùng với @progress_aggregate_history -&amp;gt; update&lt;br&gt;2. Bản ghi nào chưa được tạo, đẩy vào mảng và bulk import&amp;nbsp;progress_aggregate_results(Bằng một câu lệnh import) dựa vào mảng &lt;b&gt;@progress_aggregate_results&lt;/b&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;align=left;size=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry y="1001.6993464052289" width="244.94758909853246" height="144.57516339869284" as="geometry" />
        </mxCell>
        <mxCell id="RsV1DuCLyckvF859KtTO-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="sSDgTFBMNbOVSoMMUStR-0" source="RsV1DuCLyckvF859KtTO-43" target="RsV1DuCLyckvF859KtTO-52" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fWi1f5fFc3dsj06Epf7p-29" value="SELECT *&lt;br&gt;FROM &lt;b&gt;@works&lt;/b&gt;&lt;br&gt;WHERE ((main_work_type = main_work_type AND sub_work_type = sub_work_type) OR ......)&lt;br&gt;AND a_item_id IS NOT NULL&lt;br&gt;&lt;br&gt;&lt;br&gt;------------------------------------------------------------------------------------------------------------------------------------&lt;br&gt;(Cặp main,sub lấy ở bên cạnh - Vì cặp &lt;b&gt;main/sub này&lt;/b&gt; dữ liệu ít hơn rất nhiều so với &lt;b&gt;work_ids&lt;/b&gt;)&lt;br&gt;Phần xử lý a_item_id IS NOT NULL tương ứng cho b,c,d và &lt;b&gt;không&lt;/b&gt; xử lý đối với mảng&amp;nbsp;&lt;b&gt;work_calculate_no_item_lists&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="sSDgTFBMNbOVSoMMUStR-0" vertex="1">
          <mxGeometry x="767.9974423480083" y="678.9866666666667" width="756.1425576519915" height="134.24836601307192" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="baE6JWP1PJXw2c0-qdhX" name="ALL">
    <mxGraphModel dx="1977" dy="4457" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2339" pageHeight="3300" math="0" shadow="0">
      <root>
        <mxCell id="0FfLFZVZXuPbjJSegVRq-0" />
        <mxCell id="0FfLFZVZXuPbjJSegVRq-1" parent="0FfLFZVZXuPbjJSegVRq-0" />
        <mxCell id="QlUnBlVqZod6k9I0tSHX-0" value="" style="group" parent="0FfLFZVZXuPbjJSegVRq-1" vertex="1" connectable="0">
          <mxGeometry x="69" y="-780" width="565.69" height="727" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-1" value="Tìm tất cả công trường phục vụ cho việc chạy batch&lt;br&gt;&lt;b&gt;@progress_field_settings&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="45" y="180" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-2" value="Tìm trong bảng progress_field_settings, với input_end_date và input_start_date NOT NUL và input_end_date + 14 days &amp;gt;= NOW&lt;br&gt;=&amp;gt; &lt;b&gt;@progress_field_settings&lt;/b&gt;&lt;br&gt;SQL sample" style="rounded=0;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="299.75" y="60" width="251.25" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-1" target="QlUnBlVqZod6k9I0tSHX-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-4" value="Kiểm tra xem có &lt;b&gt;@field_id&lt;/b&gt; tuyền vào không" style="rhombus;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="354.38" y="160" width="142" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-2" target="QlUnBlVqZod6k9I0tSHX-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-6" value="Gán lại @progress_field_settings =&lt;br&gt;@progress_field_settings.where(field_id: &lt;b&gt;@field_id&lt;/b&gt;)" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="285.07" y="280" width="280.62" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-4" target="QlUnBlVqZod6k9I0tSHX-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-8" value="YES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="411" y="240" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-9" value="Bulk import dữ liệu vào bảng @progress_aggregate_history" style="rounded=0;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="45" y="370" width="170" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-1" target="QlUnBlVqZod6k9I0tSHX-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-12" target="QlUnBlVqZod6k9I0tSHX-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-12" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;b&gt;@aggregated_at&lt;/b&gt;&lt;span&gt; = Time.now&lt;/span&gt;&lt;/div&gt;&lt;b&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;b&gt;@user_id&lt;/b&gt;&lt;span style=&quot;font-weight: normal&quot;&gt; = user_id (input)&lt;/span&gt;&lt;/div&gt;&lt;/b&gt;&lt;b&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;b&gt;@field_id&lt;/b&gt;&lt;span style=&quot;font-weight: normal&quot;&gt; = field_id(input)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;@batch_type&lt;span style=&quot;font-weight: normal&quot;&gt; = batch_type(input) - default = 0&lt;/span&gt;&lt;/div&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-13" value="SQL sample, theo @user_id,&amp;nbsp;&lt;b style=&quot;text-align: center&quot;&gt;@progress_field_settings&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="299.75" y="370" width="226.5" height="80" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-9" target="QlUnBlVqZod6k9I0tSHX-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-15" value="&lt;b&gt;@batch_type&lt;/b&gt; = 0 || &lt;b&gt;@batch_type &lt;/b&gt;IS NULL" style="rhombus;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="47" y="490" width="166" height="100" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-9" target="QlUnBlVqZod6k9I0tSHX-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-17" value="RUN ONLY BATCH ALL" style="rounded=0;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="306" y="510" width="175" height="60" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-15" target="QlUnBlVqZod6k9I0tSHX-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-19" value="RUN BOTH BATCH ALL AND DIFF" style="rounded=0;whiteSpace=wrap;html=1;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="42.5" y="660" width="175" height="67" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="QlUnBlVqZod6k9I0tSHX-0" source="QlUnBlVqZod6k9I0tSHX-15" target="QlUnBlVqZod6k9I0tSHX-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-21" value="YES" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="217.5" y="510" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="QlUnBlVqZod6k9I0tSHX-22" value="NO" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="QlUnBlVqZod6k9I0tSHX-0" vertex="1">
          <mxGeometry x="119.75" y="600" width="60" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="DltKAixfffyfA3AKhqVB" name="BATCH DIFF GLOBAL">
    <mxGraphModel dx="1186" dy="694" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2339" pageHeight="3300" math="0" shadow="0">
      <root>
        <mxCell id="3cW1AI12gyz27fCyt-ny-0" />
        <mxCell id="3cW1AI12gyz27fCyt-ny-1" parent="3cW1AI12gyz27fCyt-ny-0" />
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-0" value="" style="group" parent="3cW1AI12gyz27fCyt-ny-1" vertex="1" connectable="0">
          <mxGeometry x="80" y="20" width="833" height="570" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-1" value="Lấy ra danh sách các progress_work_type_settings chưa được chạy batch (đổi địa điểm)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="40eiS2Aqu3ZYy4VPB66q-0" vertex="1">
          <mxGeometry x="11.732394366197184" width="222.91549295774647" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-2" value="Lấy ra danh sách [main,sub] đã đồng bộ ở các lần lịch sử trước =&amp;gt; &lt;b&gt;@progress_work_type_is_batched&lt;br&gt;[main, sub]&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="40eiS2Aqu3ZYy4VPB66q-0" vertex="1">
          <mxGeometry y="147.77777777777777" width="246.38028169014083" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="40eiS2Aqu3ZYy4VPB66q-0" source="40eiS2Aqu3ZYy4VPB66q-1" target="40eiS2Aqu3ZYy4VPB66q-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-4" value="&lt;div&gt;&lt;span&gt;SELECT main_work_type_id, sub_work_type_id&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;FROM progress_aggregate_results&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;INNER JOIN progress_aggregate_histories ON&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;span&gt;progress_aggregate_histories.id =&amp;nbsp;&lt;/span&gt;&lt;span&gt;progress_aggregate_results.&lt;/span&gt;&lt;span&gt;progress_aggregate_history_id&lt;br&gt;WHERE&amp;nbsp;&lt;/span&gt;progress_aggregate_histories.field_id = @field_id&lt;br&gt;&lt;span&gt;AND&amp;nbsp;&lt;/span&gt;progress_aggregate_histories.id &amp;lt;&amp;nbsp;&lt;b&gt;@progress_aggregate_history.id&lt;/b&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="40eiS2Aqu3ZYy4VPB66q-0" vertex="1">
          <mxGeometry x="305.0422535211268" y="137.22222222222223" width="481.0281690140845" height="105.55555555555556" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="40eiS2Aqu3ZYy4VPB66q-0" source="40eiS2Aqu3ZYy4VPB66q-2" target="40eiS2Aqu3ZYy4VPB66q-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-6" value="Lấy ra danh sách [main,sub] đã chưa bộ ở các lần lịch sử trước =&amp;gt; &lt;b&gt;@progress_work_type_batch_all&lt;br&gt;[[main, sub] =&amp;gt; item_list_id]&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="40eiS2Aqu3ZYy4VPB66q-0" vertex="1">
          <mxGeometry y="321.94444444444446" width="246.38028169014083" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="40eiS2Aqu3ZYy4VPB66q-0" source="40eiS2Aqu3ZYy4VPB66q-2" target="40eiS2Aqu3ZYy4VPB66q-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-8" value="&lt;div&gt;&lt;/div&gt;SELECT *&lt;br&gt;FROM progress_work_type_settings&lt;br&gt;LEFT OUTER JOIN field_main_work_types ON field_main_work_types.id = progress_work_type_settings.field_main_work_type_id&lt;br&gt;LEFT OUTER JOIN field_sub_work_types ON field_sub_work_types.id = progress_work_type_settings.sub_work_type_id&lt;br&gt;WHERE field_main_work_types.field_id = @progress_aggregate_history.field_id&lt;br&gt;AND progress_work_type_settings.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_main_work_types.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_sub_work_types.deleted_at = &quot;1970/01/01&quot;&lt;span&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="40eiS2Aqu3ZYy4VPB66q-0" vertex="1">
          <mxGeometry x="305.0422535211268" y="285" width="527.9577464788732" height="158.33333333333334" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="40eiS2Aqu3ZYy4VPB66q-0" source="40eiS2Aqu3ZYy4VPB66q-6" target="40eiS2Aqu3ZYy4VPB66q-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-10" value="Xử lý bằng code, remove đi các phần tử [main,sub] đã tồn tại ở&lt;b&gt; @&lt;/b&gt;&lt;b&gt;progress_work_type_is_batched&lt;/b&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="40eiS2Aqu3ZYy4VPB66q-0" vertex="1">
          <mxGeometry x="445.83098591549293" y="485.55555555555554" width="246.38028169014083" height="84.44444444444444" as="geometry" />
        </mxCell>
        <mxCell id="40eiS2Aqu3ZYy4VPB66q-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="40eiS2Aqu3ZYy4VPB66q-0" source="40eiS2Aqu3ZYy4VPB66q-8" target="40eiS2Aqu3ZYy4VPB66q-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="zB5rFYCPBVv-E7xBNTa1" name="A-100-API-VERSION">
    <mxGraphModel dx="1186" dy="693" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="ZCMGDAPW4uhEa1hIEgAA-0" />
        <mxCell id="ZCMGDAPW4uhEa1hIEgAA-1" parent="ZCMGDAPW4uhEa1hIEgAA-0" />
        <mxCell id="xG-UnaJSmQLyeQxo6dOi-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-1" target="siNqwW2OM4miGv654R1Q-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-1" value="Request" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="510" y="130" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-2" target="e67xOalw7yc0c3f4mC3y-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-2" value="Routes" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="509.99999999999994" y="255" width="70" height="70" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-3" target="siNqwW2OM4miGv654R1Q-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-3" target="siNqwW2OM4miGv654R1Q-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-3" target="siNqwW2OM4miGv654R1Q-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-3" value="list&lt;br&gt;&lt;b&gt;external_version&lt;br&gt;/base_logic.call&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="680" y="265" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-8" target="siNqwW2OM4miGv654R1Q-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-8" target="siNqwW2OM4miGv654R1Q-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-8" value="ParamValidatorFactory" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="840" y="180" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-9" target="siNqwW2OM4miGv654R1Q-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-9" target="siNqwW2OM4miGv654R1Q-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-9" value="CreateFieldFactory" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="840" y="265" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-13" target="siNqwW2OM4miGv654R1Q-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="siNqwW2OM4miGv654R1Q-13" target="siNqwW2OM4miGv654R1Q-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-13" value="FieldResponseFactory" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="840" y="360" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-16" value="v20220120.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="1020" y="10" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-17" value="v20220130.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="1020" y="110" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-21" value="v20220120.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="1020" y="210" width="140" height="65" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-22" value="v20220130.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="1020" y="315" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-25" value="v20220120.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="1020" y="410" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-26" value="v20220130.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="1020" y="510" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-31" value="params[:v]" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="855" y="150" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" source="e67xOalw7yc0c3f4mC3y-0" target="siNqwW2OM4miGv654R1Q-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-0" value="check version" style="rounded=1;whiteSpace=wrap;html=1;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="570" y="370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-3" value="application_controller" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="590" y="340" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-4" value="version_logic.rb =&amp;gt; version_validator" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="520" y="430" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-5" value="base_logic.rb =&amp;gt; version_redirector.rb" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1">
          <mxGeometry x="590" y="240" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xG-UnaJSmQLyeQxo6dOi-0" value="" style="group" parent="ZCMGDAPW4uhEa1hIEgAA-1" vertex="1" connectable="0">
          <mxGeometry x="10" y="45" width="520" height="690" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-32" value="logics" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry width="80" height="40" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-33" value="external_version" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="80" y="50" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-32" target="siNqwW2OM4miGv654R1Q-33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-34" value="version_redirector.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="150" y="180" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-33" target="siNqwW2OM4miGv654R1Q-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-35" value="position" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="150" y="240" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-33" target="siNqwW2OM4miGv654R1Q-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-36" value="validator" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="310" y="447" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-37" value="v20220120.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="390" y="500" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-36" target="siNqwW2OM4miGv654R1Q-37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-38" value="fetch_data_logic" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="310" y="557" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-8" value="action_redirector.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="220" y="320" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-35" target="e67xOalw7yc0c3f4mC3y-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="e67xOalw7yc0c3f4mC3y-10" target="siNqwW2OM4miGv654R1Q-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="e67xOalw7yc0c3f4mC3y-10" target="siNqwW2OM4miGv654R1Q-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-10" value="list" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="220" y="390" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-35" target="e67xOalw7yc0c3f4mC3y-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-17" value="version_validator.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="150" y="120" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-33" target="e67xOalw7yc0c3f4mC3y-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-27" value="v20220120.rb" style="rounded=0;whiteSpace=wrap;html=1;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="390" y="610" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-38" target="e67xOalw7yc0c3f4mC3y-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-29" value="create" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="220" y="650" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" source="siNqwW2OM4miGv654R1Q-35" target="e67xOalw7yc0c3f4mC3y-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-31" value="Kiểu get dữ liệu" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="330" y="390" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="e67xOalw7yc0c3f4mC3y-32" value="Kiểu tạo dữ liệu" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="320" y="660" width="90" height="30" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-5" value="GET :positions" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="425" y="215" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="siNqwW2OM4miGv654R1Q-29" value="params[:v]" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="xG-UnaJSmQLyeQxo6dOi-0" vertex="1">
          <mxGeometry x="410" y="245" width="110" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="JMofnt7FDHEGwmMDKgJ8" name="create fields">
    <mxGraphModel dx="1825" dy="1065" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="1654" math="0" shadow="0">
      <root>
        <mxCell id="w3EZn_MHdz4rcwO2-Fmi-0" />
        <mxCell id="w3EZn_MHdz4rcwO2-Fmi-1" parent="w3EZn_MHdz4rcwO2-Fmi-0" />
        <mxCell id="F-aQPwpev_dah6S1I-b--52" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="350" y="317" width="660" height="1020" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--0" target="F-aQPwpev_dah6S1I-b--3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--0" target="F-aQPwpev_dah6S1I-b--4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--0" target="F-aQPwpev_dah6S1I-b--2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--0" value="validator" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="510" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--1" target="F-aQPwpev_dah6S1I-b--0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--1" value="create fields" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="530" y="90" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--2" target="F-aQPwpev_dah6S1I-b--11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--2" value="logic create" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="320" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--3" value="params validator" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="680" y="140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--4" value="logic validator" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="680" y="220" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--11" target="F-aQPwpev_dah6S1I-b--13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--11" target="F-aQPwpev_dah6S1I-b--46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--11" value="create fields" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="510" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--13" target="F-aQPwpev_dah6S1I-b--18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--13" value="create field_contracts" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="430" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--17" target="F-aQPwpev_dah6S1I-b--23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--17" value="create field_contract_histories" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="860" y="430" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--18" target="F-aQPwpev_dah6S1I-b--17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--18" target="F-aQPwpev_dah6S1I-b--23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--18" value="field approval?" style="rhombus;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="685" y="415" width="110" height="90" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--21" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="780" y="430" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--23" target="F-aQPwpev_dah6S1I-b--27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--23" value="create field_contractor_users" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="540" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--26" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="723" y="500" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--27" target="F-aQPwpev_dah6S1I-b--29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--27" target="F-aQPwpev_dah6S1I-b--30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--27" target="F-aQPwpev_dah6S1I-b--34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--27" value="create companies_fields" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="640" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--29" value="create main_jv" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="680" y="600" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--30" value="create sub_jvs" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="680" y="680" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--34" target="F-aQPwpev_dah6S1I-b--36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--34" value="create work_hours" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="750" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--36" target="F-aQPwpev_dah6S1I-b--38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--36" value="create field_items" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="850" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--38" target="F-aQPwpev_dah6S1I-b--40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--38" value="create check_in_out_settings" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="950" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--40" target="F-aQPwpev_dah6S1I-b--41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--40" value="create field_approvals" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="1050" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--41" target="F-aQPwpev_dah6S1I-b--44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--41" value="create crane_print_sentences" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="1150" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--44" target="F-aQPwpev_dah6S1I-b--48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--44" value="create notices&lt;br&gt;theo approval_flag?" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="1250" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--46" value="create field_images" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="675" y="330" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="w3EZn_MHdz4rcwO2-Fmi-1" source="F-aQPwpev_dah6S1I-b--48" target="F-aQPwpev_dah6S1I-b--50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--48" value="send mail create fields" style="rounded=0;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="505" y="1360" width="130" height="60" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--50" value="end" style="ellipse;whiteSpace=wrap;html=1;" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="510" y="1460" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="F-aQPwpev_dah6S1I-b--53" value="Transaction" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="w3EZn_MHdz4rcwO2-Fmi-1" vertex="1">
          <mxGeometry x="940" y="320" width="60" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="EnFwNULYKp9ZM2wZk8tj" name="batch diff draft">
    <mxGraphModel dx="1186" dy="693" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="2336" math="0" shadow="0">
      <root>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--0" />
        <mxCell id="KyXT4Y7exIN0bDBusgJ--1" parent="KyXT4Y7exIN0bDBusgJ--0" />
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-46" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FAF5FA;strokeColor=#ae4132;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="10" y="710" width="1450" height="1590" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-19" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="480" y="1601.5" width="710" height="328.5" as="geometry" />
        </mxCell>
        <mxCell id="5yMfuMc2kFHyr-0NJY9W-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="5yMfuMc2kFHyr-0NJY9W-0" target="5yMfuMc2kFHyr-0NJY9W-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="5yMfuMc2kFHyr-0NJY9W-0" target="Vw4CbIbJ9l0vzPD3hs5i-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="5yMfuMc2kFHyr-0NJY9W-0" value="Lấy &lt;b&gt;changed_works&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="562.44" y="998" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="5yMfuMc2kFHyr-0NJY9W-1" value="SELECT * FROM work_temps where flag == 0 and date between lastest_aggregate_at and aggredate_at" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="20" y="960" width="220" height="90" as="geometry" />
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="5yMfuMc2kFHyr-0NJY9W-3" target="eHoIEbXBEZ9mJxl25Jcb-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="5yMfuMc2kFHyr-0NJY9W-3" target="eHoIEbXBEZ9mJxl25Jcb-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="5yMfuMc2kFHyr-0NJY9W-3" value="Lấy &lt;b&gt;progress_work_type_settings &lt;/b&gt;theo field_id" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="532.44" y="1108" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-0" value="SELECT *&lt;br&gt;FROM progress_work_type_settings&lt;br&gt;LEFT OUTER JOIN field_main_work_types ON field_main_work_types.id = progress_work_type_settings.field_main_work_type_id&lt;br&gt;LEFT OUTER JOIN field_sub_work_types ON field_sub_work_types.id = progress_work_type_settings.sub_work_type_id&lt;br&gt;WHERE field_main_work_types.field_id = @progress_aggregate_history.field_id&lt;br&gt;AND progress_work_type_settings.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_main_work_types.deleted_at = &quot;1970/01/01&quot;&lt;br&gt;AND field_sub_work_types.deleted_at = &quot;1970/01/01&quot;" style="rounded=0;whiteSpace=wrap;html=1;align=left;fillColor=#d5e8d4;strokeColor=#82b366;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="19.997772337821488" y="1060.9509798270894" width="432.4388004895961" height="154.10662824207495" as="geometry" />
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-3" value="Lấy &lt;b&gt;progress_aggregate_results&lt;/b&gt; theo &lt;b&gt;[work_date][main][sub][place_item_id&lt;/b&gt;] lấy từ &lt;b&gt;changed_works_filters&lt;/b&gt; (phục vụ cho việc tính toán lại dữ liệu)" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="905" y="1370" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="eHoIEbXBEZ9mJxl25Jcb-5" target="Vw4CbIbJ9l0vzPD3hs5i-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-5" value="Thực hiện set place_item_id theo progress_work_type_settings và filter changed_works =&amp;gt;&amp;nbsp;&lt;b&gt;changed_works_filters&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="533.6600000000001" y="1220" width="177.56" height="92" as="geometry" />
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="eHoIEbXBEZ9mJxl25Jcb-8" target="Vw4CbIbJ9l0vzPD3hs5i-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="622.44" y="1510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eHoIEbXBEZ9mJxl25Jcb-8" value="Group theo cặp key work_date/main/sub/place_item_id và tính toán dữ liệu schedule_man_hours, result_man_hours từ&amp;nbsp;&amp;nbsp;&lt;b&gt;changed_works_filters&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="513.6600000000001" y="1370" width="217.56" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-0" value="" style="group" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1" connectable="0">
          <mxGeometry x="42.44" y="210" width="520" height="350" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--19" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="260" y="46.66666666666667" width="260" height="303.33333333333337" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--18" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry y="46.66666666666667" width="260" height="303.33333333333337" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--2" value="works" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="74.28571428571429" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--3" value="create" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="74.28571428571429" y="64.16666666666667" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--4" value="work_temps" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="341.7142857142857" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--5" value="cacl_flag :add" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="341.7142857142857" y="64.16666666666667" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" source="KyXT4Y7exIN0bDBusgJ--3" target="KyXT4Y7exIN0bDBusgJ--5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--6" value="update" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="74.28571428571429" y="140" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--8" value="cacl_flag :add" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="341.7142857142857" y="116.66666666666667" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" source="KyXT4Y7exIN0bDBusgJ--6" target="KyXT4Y7exIN0bDBusgJ--8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--9" value="cacl_flag :sub" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="341.7142857142857" y="169.16666666666669" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" source="KyXT4Y7exIN0bDBusgJ--6" target="KyXT4Y7exIN0bDBusgJ--9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--12" value="block" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="74.28571428571429" y="221.66666666666669" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--13" value="cacl_flag :sub" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="341.7142857142857" y="221.66666666666669" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" source="KyXT4Y7exIN0bDBusgJ--12" target="KyXT4Y7exIN0bDBusgJ--13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--15" value="destroy" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="74.28571428571429" y="285.83333333333337" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--16" value="cacl_flag :sub" style="rounded=0;whiteSpace=wrap;html=1;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" vertex="1">
          <mxGeometry x="341.7142857142857" y="285.83333333333337" width="89.14285714285714" height="35" as="geometry" />
        </mxCell>
        <mxCell id="KyXT4Y7exIN0bDBusgJ--17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Vw4CbIbJ9l0vzPD3hs5i-0" source="KyXT4Y7exIN0bDBusgJ--15" target="KyXT4Y7exIN0bDBusgJ--16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-1" target="Vw4CbIbJ9l0vzPD3hs5i-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-1" value="Start" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="582.44" y="730" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-2" target="5yMfuMc2kFHyr-0NJY9W-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-2" value="Input&lt;br&gt;&lt;b&gt;progress_aggregate_history&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="532.44" y="870" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-5" target="Vw4CbIbJ9l0vzPD3hs5i-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-5" target="Vw4CbIbJ9l0vzPD3hs5i-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-5" value="&lt;b&gt;progress_aggregate_results&lt;/b&gt;&lt;span&gt;&amp;nbsp;có bản ghi nào tồn tại cặp key&lt;/span&gt;&lt;br&gt;&lt;b&gt;work_date/main/sub/place_item_id&lt;/b&gt;" style="rhombus;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="507" y="1620" width="230" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-6" target="Vw4CbIbJ9l0vzPD3hs5i-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-6" value="Khởi tạo đối tượng &lt;b&gt;progress_aggregate_result&lt;/b&gt;, và push vào mảng &lt;b&gt;progress_aggregate_results&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="850" y="1642.5" width="170" height="65" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-7" target="Vw4CbIbJ9l0vzPD3hs5i-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-7" value="Khai báo mảng &lt;b&gt;progress_aggregate_results&lt;/b&gt; = [] (phục vụ cho bulk_insert)" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="528.6600000000001" y="1500" width="187.56" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-11" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="737" y="1645" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-12" target="Vw4CbIbJ9l0vzPD3hs5i-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-12" value="Update bản ghi&amp;nbsp;&lt;b&gt;progress_aggregate_result &lt;/b&gt;tương ứng với&lt;b&gt; &lt;/b&gt;schedule_man_hours và result_man_hours" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="525.72" y="1790" width="192.56" height="90" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-18" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="610" y="1730" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-20" value="&lt;b&gt;loop&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="480" y="1602" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-21" target="Vw4CbIbJ9l0vzPD3hs5i-42" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-21" value="Update các bản ghi ở bảng work_temps với id IN&amp;nbsp;&lt;b&gt;changed_works&lt;/b&gt;.ids thành flag = 1&lt;br&gt;&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="519" y="1990" width="206" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-24" value="End" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="581.9999999999999" y="2200" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-28" target="Vw4CbIbJ9l0vzPD3hs5i-42" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="1108" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1360" y="1028" />
              <mxPoint x="1360" y="2126" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-28" target="5yMfuMc2kFHyr-0NJY9W-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-28" value="&lt;b&gt;changed_works &lt;/b&gt;tồn tại hay không?" style="rhombus;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="760" y="972" width="110" height="112" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-31" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="850" y="998" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-33" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="805" y="1078" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-34" target="Vw4CbIbJ9l0vzPD3hs5i-42" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="1180" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1360" y="1266" />
              <mxPoint x="1360" y="2126" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-34" target="eHoIEbXBEZ9mJxl25Jcb-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-34" target="eHoIEbXBEZ9mJxl25Jcb-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-34" value="Kiểm tra&amp;nbsp;&lt;b&gt;changed_works_filters &lt;/b&gt;có tồn tại hay không" style="rhombus;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="767" y="1212" width="163" height="108" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-37" value="No" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="905" y="1240" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-40" value="Yes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="840" y="1320" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="KyXT4Y7exIN0bDBusgJ--1" source="Vw4CbIbJ9l0vzPD3hs5i-42" target="Vw4CbIbJ9l0vzPD3hs5i-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-42" value="Update &lt;b&gt;progress_aggregate_history&lt;/b&gt; thành status &lt;b&gt;success&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="532.0000000000001" y="2090" width="180" height="72" as="geometry" />
        </mxCell>
        <mxCell id="Vw4CbIbJ9l0vzPD3hs5i-47" value="TRANSACTION&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-weight: normal&quot;&gt;update &lt;/span&gt;progress_aggregate_history&lt;span style=&quot;font-weight: normal&quot;&gt; =&amp;gt; thành status &lt;/span&gt;error" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="KyXT4Y7exIN0bDBusgJ--1" vertex="1">
          <mxGeometry x="20" y="720" width="220" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
